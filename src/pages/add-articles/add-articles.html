
<ion-header>
    <ion-navbar>

    </ion-navbar>
</ion-header>


<ion-content padding>
    <div
            *ngIf="!categories || preloader"
            class="spinner"
    >
        <div class="spin">
            <ion-spinner name="ios-small"></ion-spinner>
        </div>
    </div>

    <div *ngIf="categories && !preloader">
        <div *ngIf="video && !imageChangedEvent">
            <div style="text-align: center">
                <ion-icon ios="ios-thumbs-up" md="md-thumbs-up"></ion-icon>
                <p style="padding-top: 10px">Ваше видео загружено и после сохранения будет доступно в режиме "Предпросмотра" на странице "Публикации"</p>
            </div>
        </div>

        <form
                [formGroup]="form"
                (ngSubmit)="previewForm()"
        >
            <ion-item class="file-upload">
                <ion-label for="avatar" class="custom-file-label padding__null">
                    Загрузите картинку/видео
                </ion-label>
                <ion-input type="file" id="avatar" (change)="fileChangeListener($event)" name="video" #fileInput></ion-input>
            </ion-item>
            <span *ngIf="!fileUploadValid && form.valid" style="color: red; font-size: 12px">
                   Загрузите пожалуйста картинку
        </span>
            <div>
                <div
                        *ngIf="bigImg && !video"
                        class="row"
                        style="padding-left: 15px"
                >
                    <img-cropper
                            #cropper
                            [image]="data"
                            [settings]="cropperSettings"
                    ></img-cropper>
                    <br>
                    <span class="result rounded" *ngIf="data.image" >
                    <img
                            style="width: 256px; height: 144px"
                            [src]="data.image"
                            [width]="cropperSettings.croppedWidth"
                            [height]="cropperSettings.croppedHeight"
                    />
                </span>
                </div>
            </div>
            <ion-item class="padding_null">
                <ion-label color="primary" stacked [ngClass]="{'invalid-feedback': form.get('header').invalid && form.get('header').touched}">Заголовок</ion-label>
                <ion-input
                        type="text"
                        placeholder="Введите заголовок"
                        formControlName="header"

                ></ion-input>

            </ion-item>
            <span
                    *ngIf="form.get('header').invalid && form.get('header').touched"
                    class="invalid-feedback"
            >
      <span *ngIf="form.get('header').errors['required']"> Введите заголовок статьи </span>
      <span *ngIf="form.get('header').errors['lengthTitleErr']">Заголовок не должен привышать {{ lengthTitle }} символов</span>
    </span>

            <ion-item >
                <ion-label color="primary" stacked>Введите текст превъю</ion-label>
                <ion-input
                        type="text"
                        placeholder="Введите текст"
                        formControlName="textPreview"
                        class="form-control"
                        [ngClass]="{'is-invalid': form.get('textPreview').invalid && form.get('textPreview').touched}"
                ></ion-input>

            </ion-item>
            <span
                    *ngIf="form.get('textPreview').invalid && form.get('textPreview').touched"
                    class="invalid-feedback"
            >
        <span *ngIf="form.get('textPreview').errors['required']">Введите превъю </span>
        <span *ngIf="form.get('textPreview').errors['lengthPreviewErr']">Превъю не должен привышать {{ lengthPreview }} символов</span>
        <span *ngIf="form.get('textPreview').errors['onlySpace']">Превъю не может состоять из одних пробелов</span>
      </span>

            <div  class="quillBox" [ngClass]="getQuillErrorClass()">
                <p class="label__text">Текст новости</p>

                <!--<quill-editor-->
                <!--style="height:100px;"-->
                <!--class="selectable"-->
                <!--toolbar="true"-->
                <!--link-tooltip="true"-->
                <!--image-tooltip="true"-->
                <!--toolbar-entries="image font size bold list bullet italic underline strike align color background link image"-->
                <!--editor-required="true"-->
                <!--required=""-->
                <!--error-class="input-error"-->
                <!--formControlName="body"-->
                <!--[(ngModel)]="description"-->

                <!--placeholder="Введите текст новости"-->
                <!--&gt;</quill-editor>-->

                <quill-editor
                        formControlName="body"
                        [modules]="editor_modules"
                        [(ngModel)]="description"
                        placeholder="Введите текст новости"
                        (onSelectionChanged)="addBindingCreated($event)"

                >
                    <div  quill-editor-toolbar>
                            <span class="ql-formats">
                                <select class="ql-font">
                                    <option selected>Roboto</option>
                                    <option value="helvetica">Helvetica</option>
                                    <option value="arial">Arial</option>
                                </select>
                                <select class="ql-size"></select>
                            </span>
                        <span class="ql-formats">
                                    <button class="ql-bold"></button>
                                    <button class="ql-italic"></button>
                                    <button class="ql-underline"></button>
                                    <button class="ql-strike"></button>
                                    </span>
                        <span class="ql-formats">
                                    <select class="ql-color"></select>
                                    <select class="ql-background"></select>
                                    </span>
                        <span class="ql-formats">
                                    <button class="ql-blockquote"></button>
                                    <button class="ql-code-block"></button>
                                    <button class="ql-link"></button>
                                    </span>
                        <span class="ql-formats">
                                    <button class="ql-header" value="1"></button>
                                    <button class="ql-header" value="2"></button>
                                    </span>
                        <span class="ql-formats">
                                    <button class="ql-list" value="ordered"></button>
                                    <button class="ql-list" value="bullet"></button>
                                    <button class="ql-indent" value="-1"></button>
                                    <button class="ql-indent" value="+1"></button>
                                    </span>
                        <span class="ql-formats">
                                    <button class="ql-direction" value="rtl"></button>
                                    <select class="ql-align"></select>
                                    </span>
                        <span class="ql-formats">
                                    <button class="ql-script" value="sub"></button>
                                    <button class="ql-script" value="super"></button>
                                    </span>
                        <span class="ql-formats">
                                    <button class="ql-video"></button>
                                    <button class="ql-image"></button>
                    </span>

                    </div>
                </quill-editor>
                <span
                        *ngIf="quillLengthLessNeed"
                        style="color: red; font-size: 12px"
                >
                    Введите статью
                </span>
                <span
                        *ngIf="quillLengthLarge"
                        style="color: red; font-size: 12px"
                >
                    Статья не должна привышать {{ lengthBody }} символов
                </span>
            </div>
            <label class="containerBox">Приватность
                <input  formControlName="private" type="checkbox" id="privacy"   name="privacy">
                <span class="checkmark"></span>
            </label>
            <label class="containerBox">Главная новость
                <input  formControlName="topNews" type="checkbox" id="topNews"   name="topNews">
                <span class="checkmark"></span>
            </label>
            <p class="label__text">Категории</p>
            <ion-list radio-group formControlName="food">
                <ion-item *ngFor="let category of categories">
                    <ion-label>{{ category.name }}</ion-label>
                    <ion-radio

                            type="radio"
                            [value]="category._id"
                    ></ion-radio>
                </ion-item>
            </ion-list>
            <div class="alert-button-group">
                <button
                        ion-button color="secondary"
                        type="submit"
                        [disabled]="form.invalid || !fileUploadValid || video"
                >Предпросмотр</button>
                <button
                        ion-button color="danger"
                        type="button"
                        (click)="sendOneNews()"
                        [disabled]="form.invalid || !fileUploadValid"
                >Сохранить</button>
            </div>
        </form>
    </div>
</ion-content>
